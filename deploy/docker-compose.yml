version: '3.5'

services:
  fluent-bit:
    image: fluent/fluent-bit:${IMAGE_TAG:-latest}
    networks:
      - log-net
    ports:
      - target: ${PORT}
        published: ${PORT}
        mode: host
    configs:
      - source: fluent-bit-conf
        target: /fluent-bit/etc/fluent-bit.conf
    logging:
      driver: json-file
    deploy:
      mode: global
      restart_policy:
        delay: 5s
        window: 30s
      resources:
        limits:
          cpus: '0.1'
          memory: 64M
        reservations:
          memory: 16M

networks:
  log-net:
    name: ${LOG_NET_NAME:-log-net}
    driver: overlay
    attachable: ${LOG_NET_ATTACHABLE:-true}

configs:
  fluent-bit-conf:
    name: ${FLUENT_BIT_CONF_NAME:-fluent-bit-conf}
    file: ./conf/fluent-bit.conf
